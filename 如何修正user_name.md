# 修正作業提交記錄的 user_name 教學

## 問題說明

在 `作業提交記錄` 工作表中，`user_name` 欄位顯示的是 Google 數字 ID（例如：`114880545246648211895`），而不是格式化的學生姓名（例如：`01_黃守杰`）。

## 解決方案

我們已經建立了兩個修正函數：

### 1. 測試函數（預覽功能）

**函數名稱：** `testFixTaskSubmissionUserNames()`

**功能：** 只預覽會被修正的記錄，不會實際修改資料

**使用步驟：**

1. 開啟 Google Apps Script 編輯器
2. 開啟檔案 `fix_user_names.gs`
3. 在函數下拉選單中選擇 `testFixTaskSubmissionUserNames`
4. 點擊「執行」按鈕（播放圖示）
5. 查看執行記錄（Ctrl+Enter 或選單 View > Logs）

**執行記錄範例：**
```
=== 預覽：將被修正的記錄 ===
第 5 筆: 114880545246648211895 -> 01_黃守杰
第 8 筆: 114880545246648211895 -> 02_陳小明
第 12 筆: 103829405857839201847 -> 03_李小華
...

📊 總共會修正 25 筆記錄

👉 確認無誤後，請執行 fixTaskSubmissionUserNames() 進行實際修正
```

### 2. 實際修正函數

**函數名稱：** `fixTaskSubmissionUserNames()`

**功能：** 批次修正所有錯誤的 user_name

**使用步驟：**

1. **先執行測試函數確認無誤**
2. 在函數下拉選單中選擇 `fixTaskSubmissionUserNames`
3. 點擊「執行」按鈕
4. 等待執行完成
5. 查看執行記錄確認修正結果

**執行記錄範例：**
```
📖 建立學員姓名對照表...
✅ 對照表建立完成，共 30 筆學員資料
🔍 開始檢查作業提交記錄...
📊 總共 50 筆提交記錄
✏️ 第 5 筆: 114880545246648211895 -> 01_黃守杰
✏️ 第 8 筆: 114880545246648211895 -> 02_陳小明
✏️ 第 12 筆: 103829405857839201847 -> 03_李小華
✏️ 第 15 筆: 114880545246648211895 -> 01_黃守杰
✏️ 第 18 筆: 109384756029384756123 -> 04_王大明
（只顯示前5筆）

=== 修正完成 ===
✅ 已修正: 25 筆
⏭️ 跳過: 25 筆（格式正確或找不到對應學員）
📊 總計: 50 筆
```

## 修正邏輯

函數會自動執行以下步驟：

1. **讀取學員資料表** (`學員資料`)
   - 取得每位學員的 email、座號、姓名

2. **建立對照表**
   - 將座號格式化為兩位數（例如：1 → 01）
   - 組合成 `01_黃守杰` 格式

3. **掃描作業提交記錄**
   - 檢查 `user_name` 是否為錯誤的數字 ID（10位數以上）
   - 根據 `user_email` 在對照表中查找正確姓名
   - 更新為正確的格式化姓名

4. **統計結果**
   - 已修正：數字 ID 成功改為格式化姓名的記錄數
   - 跳過：格式已正確或找不到對應學員的記錄數

## 未來預防

我已經修正了 [code.gs:6772-6801](c:\Users\GPPS\Downloads\Differentiated_Instruction-main\code.gs#L6772-L6801)，未來學生上傳作業時，系統會自動從 `學員資料` 表讀取格式化姓名，不會再出現數字 ID 的問題。

## 注意事項

⚠️ **執行前請確認：**
1. 已在 `學員資料` 表中正確填寫所有學生的座號和姓名
2. 先執行測試函數預覽結果
3. 確認預覽結果無誤後再執行實際修正

✅ **執行後確認：**
1. 檢查 `作業提交記錄` 表中的 user_name 欄位
2. 確認已改為 `01_黃守杰` 格式
3. 前端「作業批改」頁面會自動顯示正確的學生姓名
