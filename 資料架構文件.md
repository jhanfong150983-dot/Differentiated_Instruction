# 分層教學平台 - 資料架構文件

## Google Sheets 資料表結構

### 1. 使用者資料表 (USERS)
**工作表名稱**: `使用者資料`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| user_id | A (index 0) | UUID | 使用者唯一識別碼 |
| google_id | B (index 1) | 字串 | 可能是 Google 數字 ID|
| email | C (index 2) | 字串 | 使用者 Email |
| name | D (index 3) | 字串 | Google 帳號 名稱 |
| role | E (index 4) | 字串 | 角色（student/teacher/admin）|
| registration_date |  F(index 5) | 日期時間 | 建立時間 |
| last_login |  G(index 6) | 日期時間 | 最後登入時間 |
| status |  H(index 7) | 字串 | 狀態 |
| total_tokens |  I(index 8) | 字串 | 總共金幣 |

### 2. 登入紀錄表 (LOGIN_HISTORY)
**工作表名稱**: `登入紀錄表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| log_id | A (index 0) | UUID | 登入唯一識別碼 |
| user_id | B (index 1) | UUID | 使用者唯一識別碼 |
| login_time | C (index 2) | 日期時間 | 登入時間 |
| device_type | D (index 3) | 字串 | 登入方式 |
| status |  E(index 4) | 字串 | 狀態 |

### 3. 班級資料表 (CLASSES)
**工作表名稱**: `班級資料`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| class_id | A (index 0) | UUID | 班級唯一識別碼 |
| class_name | B (index 1) | 字串 | 班級名稱（例：科技任務課程：五年6班）|
| teacher_email | C (index 2) | 字串 | 主要教師 Email |
| create_date | D (index 3) | 日期時間 | 建立時間 |
| co_teachers | E (index 4) | 字串 | 協同教師 Email（用 \| 分隔）|

### 4. 學員資料表 (CLASS_MEMBERS)
**工作表名稱**: `學員資料`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| uuid | A (index 0) | UUID | 記錄唯一識別碼 |
| class_id | B (index 1) | UUID | 班級 ID（外鍵）|
| seat_number | C (index 2) | 數字 | 座號 |
| student_name | D (index 3) | 字串 | 學生真實姓名 |
| student_email | E (index 4) | 字串 | 學生 Email |
| user_id | F (index 5) | UUID | 使用者 ID（外鍵）|

### 5. 課程資料表 (COURSES)
**工作表名稱**: `課程資料`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| course_id | A (index 0) | UUID | 課程唯一識別碼 |
| course_name | B (index 1) | 字串 | 課程名稱 |
| teacher_email | C (index 2) | 字串 | 課程建立者 Email |
| description | D (index 3) | 字串 | 課程說明 |
| created_date | E (index 4) | 日期時間 | 建立時間 |

### 6. 任務資料表 (TASKS)
**工作表名稱**: `任務資料`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| task_id | A (index 0) | UUID | 任務唯一識別碼 |
| course_id | B (index 1) | UUID | 課程 ID（外鍵）|
| sequence | C (index 2) | 數字 | 排序順序 |
| task_name | D (index 3) | 字串 | 任務名稱 |
| time_limit | E (index 4) | 字串 | 時間限制 |
| tutorial_desc | F (index 5) | 字串 | 新手村任務說明 |
| tutorial_link | G (index 6) | URL | 新手村連結 |
| adventure_desc | H (index 7) | 字串 | 冒險村任務說明 |
| adventure_link | I (index 8) | URL | 冒險村連結 |
| hardcore_desc | J (index 9) | 字串 | 地獄村任務說明 |
| hardcore_link | K (index 10) | URL | 地獄村連結 |
| token_reward | L (index 11) | 字串 | 通過金幣數 |
| created_date | M (index 12) | 日期時間 |建立時間 |

### 7. 授課安排表 (ASSIGNMENTS)
**工作表名稱**: `授課安排表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| assignment_id | A (index 0) | UUID | 安排唯一識別碼 |
| class_id | B (index 1) | UUID | 班級 ID（外鍵）|
| course_id | C (index 2) | UUID | 課程 ID（外鍵）|
| teacher_email | D (index 3) | 字串 | 主要教師 Email |
| assigned_date | E (index 4) | 日期時間 | 授權時間 |
| status | F (index 5) | 字串 | 狀態（active/inactive）|

### 8. 學習資料表 (LEARNING_RECORDS)
**工作表名稱**: `學習資料表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| record_id | A (index 0) | UUID | 記錄唯一識別碼 |
| user_id | B (index 1) | UUID | 使用者 ID（外鍵）|
| class_id | C (index 2) | UUID | 班級 ID（外鍵）|
| course_id | D (index 3) | UUID | 課程 ID（外鍵）|
| teacher_email | E (index 4) | 字串 | 主要教師 Email |
| start_date | F (index 5) | 日期時間 | 開始課程日期 |
| last_access_date | G (index 6) | 日期時間 | 最近一次進行課程日期 |
| status | H (index 7) | 字串 | 課程執行狀態(in_progress/completed) |
| completed_tasks | I (index 8) | 字串 | 完成任務數量 |
| total_tasks | J (index 9) | 字串 | 總共任務數量 |
| current_tier | K (index 10) | 字串 | 難度層級(tutorial/adventure/hardcore) |

### 9. 任務進度表 (TASK_PROGRESS)
**工作表名稱**: `任務進度表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| progress_id | A (index 0) | UUID | 進度唯一識別碼 |
| record_id | B (index 1) | UUID | 學習記錄 ID（外鍵）|
| task_id | C (index 2) | UUID | 任務 ID（外鍵）|
| status | D (index 3) | 字串 | 狀態(in_progress/self_checking/assessment/completed) |
| start_time | E (index 4) | 日期時間 | 開始任務日期 |
| completed_time | F (index 5) | 日期時間 | 完成任務時間 |
| time_spent | G (index 6) | 字串 | 當前難度層級 |

### 10. 難度變更記錄表 (DIFFICULTY_CHANGES)
**工作表名稱**: `難度變更記錄表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| change_id | A (index 0) | UUID | 進度唯一識別碼 |
| record_id | B (index 1) | UUID | 學習記錄 ID（外鍵）|
| user_id | C (index 2) | UUID | 使用者 ID（外鍵）|
| course_id | D (index 3) | UUID | 課程 ID（外鍵）|
| from_tier | E (index 4) | 字串 | 轉換前難度層級|
| to_tier | F (index 5) | 字串 | 轉換後難度層級 |
| change_reson | G (index 6) | 字串 | 轉換理由 |
| change_time | H (index 7) | 日期時間 | 轉換時間 |
| triggered_by_task | I (index 8) | 字串 | 轉換關鍵任務 |

### 11. 課堂記錄表 (CLASS_SESSIONS)
**工作表名稱**: `課堂記錄`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| session_id | A (index 0) | UUID | 進度唯一識別碼 |
| class_id | B (index 1) | UUID | 班級唯一識別碼 |
| teacher_email | C (index 2) | 字串 | 課程建立者 Email |
| start_time | D (index 3) | 日期時間 | 開始時間 |
| end_time | E (index 4) | 日期時間 | 結束時間 |
| status | F (index 5) | 字串 | 課堂狀態(active/ended) |
| course_id | G (index 6) | UUID | 課程 ID（外鍵）|
| created_date | H (index 7) | 日期時間 | 建立時間 |


### 12. 作業提交記錄表 (TASK_SUBMISSIONS)
**工作表名稱**: `作業提交記錄表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| submission_id | A (index 0) | UUID | 提交記錄唯一識別碼 |
| progress_id | B (index 1) | UUID | 任務進度 ID（外鍵）|
| user_email | C (index 2) | 字串 | 提交者 Email |
| user_id | D (index 3) | UUID | 使用者 ID（外鍵）|
| user_name | E (index 4) | 字串 | **使用者顯示名稱**（應為格式化姓名）|
| class_id | F (index 5) | UUID | 班級 ID（外鍵）|
| class_name | G (index 6) | 字串 | 班級名稱|
| task_id | H (index 7) | UUID | 任務 ID（外鍵）|
| task_name | I (index 8) | 字串 | 任務名稱|
| file_url | J (index 9) | URL | 檔案網址 |
| file_name | K (index 10) | 字串 | 檔案名稱 |
| file_type | L (index 11) | 字串 | 檔案類型 |
| file_size | M (index 12) | 數字 | 檔案大小 |
| upload_time | N (index 13) | 日期時間 | 提交時間 |
| version | O (index 14) | 數字 | 版本號 |
| is_latest | P (index 15) | 布林 | 是否最新版本 |
| submission_status | Q (index 16) | 字串 | 繳交狀態(待批改/已批改) |
| review_status | R (index 17) | 字串 | 批改狀態（未批改/已批改）|
| reviewer_email | S (index 18) | 字串 | 主要批改教師|
| reviewer_name | T (index 19) | 字串 | 主要批改教師名稱|
| review_time | U (index 20) | 日期時間 | 批改時間|
| review_score | V (index 21) | 字串 | 批改分數|
| review_comment | W (index 22) | 字串 | 批改回應 |
| review_feedback_file | X (index 23) | 字串 | 批改建議|

### 13. 檢核項目表 (TASK_CHECKLISTS)
**工作表名稱**: `檢核項目表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| checklist_id | A (index 0) | UUID | 檢核項目唯一識別碼 |
| task_id | B (index 1) | UUID | 任務唯一識別碼 |
| item_order | C (index 2) | 字串 | 檢核項目順序 |
| item_title | D (index 3) | 字串 | 檢核項目標題 |
| item_description | E (index 4) | 字串 | 檢核項目描述 |

### 14. 正確答案示範表 (TASK_REFERENCE_ANSWERS)
**工作表名稱**: `正確答案示範表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| answer_id | A (index 0) | UUID | 答案唯一識別碼 |
| task_id | B (index 1) | UUID | 任務唯一識別碼 |
| answer_text  | C (index 2) | 字串 | 答案文字 |
| answer_images  | D (index 3) | 連結 | 答案照片 |
| created_date | E (index 4) | 日期時間 | 建立時間 |
| updated_date | F (index 5) | 日期時間 | 更新時間 |

### 15. 題庫表 (TASK_QUESTIONS)
**工作表名稱**: `題庫表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| question_id| A (index 0) | UUID | 問題唯一識別碼 |
| task_id | B (index 1) | UUID | 任務唯一識別碼 |
| question_text  | C (index 2) | 字串 | 題目 |
| option_a  | D (index 3) | 字串 | 選項A |
| option_b | E (index 4) | 字串 | 選項B |
| option_c | F (index 5) | 字串 | 選項C |
| option_d | G (index 6) | 字串 | 選項D |
| correct_answer | H (index 7) | 字串 | 正確答案 |

### 16. 自主檢查記錄表 (SELF_CHECK_RECORDS)
**工作表名稱**: `自主檢查記錄表`

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| check_record_id | A (index 0) | UUID | 檢查唯一識別碼 |
| progress_id | B (index 1) | UUID | 進度唯一識別碼 |
| student_email  | C (index 2) | 字串 | 學生信箱 |
| user_id    | D (index 3) | 字串 | 使用者ID |
| checklist_id | E (index 4) | UUID | 檢核項目唯一識別碼 |
| student_checked  | F (index 5) | 布林 | 學生檢查狀態 |
| check_time | G (index 6) | 日期時間 | 學生檢查時間 |

### 17. 評量記錄表 (TASK_ASSESSMENT_RECORDS)
**工作表名稱**: `評量記錄表`

**使用場景**:
- `submitTaskExecution()`: 完整任務執行提交（自檢+上傳+評量）
- `submitAssessment()`: 單題評量提交（支援重複嘗試）

| 欄位名稱 | 欄位位置 | 資料型別 | 說明 |
|---------|---------|---------|------|
| assessment_id  | A (index 0) | UUID | 評量記錄唯一識別碼 |
| task_progress_id | B (index 1) | UUID | 任務進度唯一識別碼 |
| student_email  | C (index 2) | 字串 | 學生信箱 |
| user_id    | D (index 3) | 字串 | 使用者ID |
| question_answers | E (index 4) | JSON字串 | 評量題目與答案<br/>• submitTaskExecution: `{"q1":"A","q2":"B",...}` (所有題目)<br/>• submitAssessment: `{"q1":"A"}` (單題) |
| accuracy | F (index 5) | 小數 (0.0-1.0) | 答對率（小數格式）<br/>• submitTaskExecution: 0.0-1.0 (如 0.6667 代表 66.67%)<br/>• submitAssessment: 0 或 1 (答錯或答對) |
| submit_time  | G (index 6) | 日期時間 | 提交時間 |

**備註**:
- 學生每次重新嘗試評量會新增一筆記錄（不覆蓋）
- 嘗試次數 = 計算同一個 `task_progress_id` 的記錄數量
- 是否答對 = `accuracy` 是否為 1 (或接近 1.0)
- 顯示時需轉換：`(accuracy * 100).toFixed(0) + '%'`